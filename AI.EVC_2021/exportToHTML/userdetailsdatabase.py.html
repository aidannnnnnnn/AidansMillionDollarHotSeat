<html>
<head>
<title>userdetailsdatabase.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
userdetailsdatabase.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime                     </span><span class="s2">#import the date time module</span>


<span class="s0">class </span><span class="s1">DataBase: </span><span class="s2">#Creates an object constructor for the Data Base</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">filename): </span><span class="s2">#A function that initialises the attributes of the DataBase class</span>
        <span class="s1">self.filename = filename  </span><span class="s2">#declares the self.filename variable as filename</span>
        <span class="s1">self.users = </span><span class="s0">None         </span><span class="s2">#declares the self.users variable as None (There is nothing inside it)</span>
        <span class="s1">self.file = </span><span class="s0">None          </span><span class="s2">#declares the self.file variable as None (as there is nothing inside it)</span>
        <span class="s1">self.load()               </span><span class="s2">#calls the self.load function</span>

    <span class="s0">def </span><span class="s1">load(self):                                                     </span><span class="s2">#a function that loads the user details from the text file.</span>
        <span class="s1">self.file = open(self.filename</span><span class="s0">, </span><span class="s3">&quot;r&quot;</span><span class="s1">)                            </span><span class="s2">#open the users file, for reading purposes</span>
        <span class="s1">self.users = {}                                                 </span><span class="s2">#create an empty dictionary for the users</span>

        <span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">self.file:                                          </span><span class="s2">#for each line in the file</span>
            <span class="s1">email</span><span class="s0">, </span><span class="s1">password</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">created = line.strip().split(</span><span class="s3">&quot;;&quot;</span><span class="s1">)    </span><span class="s2">#split the email, password, name and date created by a &quot;;&quot;</span>
            <span class="s1">self.users[email] = (password</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">created)               </span><span class="s2">#match each user email with the password, name of user and the date created.</span>

        <span class="s1">self.file.close()                                               </span><span class="s2">#close the file</span>

    <span class="s0">def </span><span class="s1">get_user(self</span><span class="s0">, </span><span class="s1">email):                                          </span><span class="s2">#this function demonstrates what happens if the user wants to &quot;get&quot; their email</span>
        <span class="s0">if </span><span class="s1">email </span><span class="s0">in </span><span class="s1">self.users:                                         </span><span class="s2">#if the email exists in the user dictionary</span>
            <span class="s0">return </span><span class="s1">self.users[email]                                    </span><span class="s2">#return the users email</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s4">1                                                   </span><span class="s2">#else return that the user does not exist</span>

    <span class="s0">def </span><span class="s1">add_user(self</span><span class="s0">, </span><span class="s1">email</span><span class="s0">, </span><span class="s1">password</span><span class="s0">, </span><span class="s1">name):                                                  </span><span class="s2">#This function declares what happens if the user chooses to create a new account</span>
        <span class="s0">if </span><span class="s1">email.strip() </span><span class="s0">not in </span><span class="s1">self.users:                                                     </span><span class="s2">#if the email is not in the user list...</span>
            <span class="s1">self.users[email.strip()] = (password.strip()</span><span class="s0">, </span><span class="s1">name.strip()</span><span class="s0">, </span><span class="s1">DataBase.get_date())   </span><span class="s2">#if the stripped email does not</span>
            <span class="s1">self.save()                                                                         </span><span class="s2">#calls the self.save function</span>
            <span class="s0">return </span><span class="s4">1                                                                            </span><span class="s2">#Return 1: The email was created</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s3">&quot;Email exists already&quot;</span><span class="s1">)           </span><span class="s2"># If the email is in the user dictionary, print that it already exists</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s4">1                               </span><span class="s2"># return -1 to show the occurence was False</span>

    <span class="s0">def </span><span class="s1">validate(self</span><span class="s0">, </span><span class="s1">email</span><span class="s0">, </span><span class="s1">password):                </span><span class="s2">#this function shows whathappens when the user validates their email and password (i.e. the app confirms if their details are legitimate)</span>
        <span class="s0">if </span><span class="s1">self.get_user(email) != -</span><span class="s4">1</span><span class="s1">:                  </span><span class="s2">#if the user email is not a false occurence (i.e. it exists)</span>
            <span class="s0">return </span><span class="s1">self.users[email][</span><span class="s4">0</span><span class="s1">] == password     </span><span class="s2">#Return the password to the email that the user has entered</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return False                                </span><span class="s2">#If the user email is a false occurence, return False to represent this</span>

    <span class="s0">def </span><span class="s1">save(self):                                         </span><span class="s2">#This function defines what happens once the user creates their account and submits it</span>
        <span class="s0">with </span><span class="s1">open(self.filename</span><span class="s0">, </span><span class="s3">&quot;w&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">fileToOpen:        </span><span class="s2">#Open the user database to write to is</span>
            <span class="s0">for </span><span class="s1">user </span><span class="s0">in </span><span class="s1">self.users:                         </span><span class="s2">#For the user in the user dictionary</span>
                <span class="s1">fileToOpen.write(user + </span><span class="s3">&quot;;&quot; </span><span class="s1">+ self.users[user][</span><span class="s4">0</span><span class="s1">] + </span><span class="s3">&quot;;&quot; </span><span class="s1">+ self.users[user][</span><span class="s4">1</span><span class="s1">] + </span><span class="s3">&quot;;&quot; </span><span class="s1">+ self.users[user][</span><span class="s4">2</span><span class="s1">] + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)    </span><span class="s2">#Write the user's details to the file, splitting each aspect with a &quot;;&quot;, and adding a newline at the end</span>

    <span class="s1">@staticmethod</span>
    <span class="s0">def </span><span class="s1">get_date():                                         </span><span class="s2">#This function defines what happens if the</span>
        <span class="s0">return </span><span class="s1">str(datetime.datetime.now()).split(</span><span class="s3">&quot; &quot;</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]   </span><span class="s2">#return the time of the login</span></pre>
</body>
</html>